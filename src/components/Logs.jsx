import React, { useState } from 'react';
import { Info, AlertCircle } from 'lucide-react';
import { Modal, Button } from './ui/BaseComponents';

const Logs = () => {
    const [nausea, setNausea] = useState(null);
    const [foodNoise, setFoodNoise] = useState(3);
    const [showFoodNoiseInfo, setShowFoodNoiseInfo] = useState(false);
    const [note, setNote] = useState('');
    const [showTriggerField, setShowTriggerField] = useState(false);

    const [selectedSymptoms, setSelectedSymptoms] = useState([]);

    const symptoms = [
        { id: 'nausea', emoji: 'ü§¢', label: 'N√°usea' },
        { id: 'vomito', emoji: 'ü§Æ', label: 'V√¥mito' },
        { id: 'fadiga', emoji: 'ü•±', label: 'Fadiga' },
        { id: 'azia', emoji: 'üî•', label: 'Azia' },
        { id: 'constipa√ß√£o', emoji: 'üß±', label: 'Constipa√ß√£o' },
    ];

    const toggleSymptom = (id) => {
        setSelectedSymptoms(prev =>
            prev.includes(id) ? prev.filter(s => s !== id) : [...prev, id]
        );
        if (id === 'nausea' || id === 'vomito') {
            setShowTriggerField(true);
        }
    };

    const getSliderColor = () => {
        if (foodNoise <= 3) return 'bg-teal-500';
        if (foodNoise <= 7) return 'bg-orange-500';
        return 'bg-red-500';
    };

    return (
        <div className="space-y-6 pb-24">
            <h2 className="text-2xl font-bold mb-5 ml-1 stagger-1 fade-in">Di√°rio de Hoje</h2>

            {/* Symptoms Card */}
            <div className={`glass-panel p-6 rounded-[32px] shadow-soft stagger-2 fade-in transition-all duration-500 ${selectedSymptoms.includes('vomito') ? 'nausea-strong-glow' : ''}`}>
                <label className="block text-sm font-bold text-slate-600 mb-4 uppercase tracking-wide font-outfit">Sintomas do Dia</label>
                <div className="grid grid-cols-5 gap-2">
                    {symptoms.map((symptom) => (
                        <button
                            key={symptom.id}
                            onClick={() => toggleSymptom(symptom.id)}
                            className={`aspect-square rounded-2xl bg-white border border-slate-100 shadow-sm flex flex-col items-center justify-center gap-1 transition-all group focus:ring-2 active:scale-95 ${selectedSymptoms.includes(symptom.id)
                                    ? `ring-2 ring-brand-500 border-brand-200 bg-brand-50`
                                    : `hover:bg-slate-50`
                                }`}
                        >
                            <span className={`text-2xl transition-transform ${selectedSymptoms.includes(symptom.id) ? 'scale-110' : 'group-hover:scale-110'}`}>{symptom.emoji}</span>
                            <span className={`text-[8px] font-black uppercase ${selectedSymptoms.includes(symptom.id) ? `text-brand-600` : 'text-slate-400'}`}>{symptom.label}</span>
                        </button>
                    ))}
                </div>

                {showTriggerField && (
                    <div className="mt-6 p-4 bg-orange-50 rounded-2xl border border-orange-100 animate-slideUp">
                        <div className="flex items-center gap-2 mb-2 text-orange-600">
                            <AlertCircle size={16} />
                            <span className="text-xs font-bold uppercase tracking-wider">Identificar Gatilho</span>
                        </div>
                        <input
                            type="text"
                            placeholder="Ex: Doce, gordura, cheiro forte..."
                            className="w-full bg-white border-none rounded-xl p-3 text-sm focus:ring-2 focus:ring-orange-500 shadow-inner"
                        />
                    </div>
                )}
            </div>

            {/* Food Noise Card */}
            <div className="glass-panel p-6 rounded-[32px] shadow-soft stagger-3 fade-in">
                <div className="flex justify-between items-center mb-6">
                    <div className="flex items-center gap-2">
                        <label className="block text-sm font-bold text-slate-600 uppercase tracking-wide font-outfit">Food Noise</label>
                        <button
                            onClick={() => setShowFoodNoiseInfo(true)}
                            className="text-slate-400 hover:text-brand transition-colors"
                        >
                            <Info size={16} />
                        </button>
                    </div>
                    <span className={`text-[10px] px-2.5 py-1 rounded-full font-bold uppercase tracking-wider text-white transition-colors ${getSliderColor()}`}>
                        {foodNoise <= 3 ? 'Silencioso' : foodNoise <= 7 ? 'Moderado' : 'Alto'}
                    </span>
                </div>

                <div className="relative h-2 w-full bg-slate-100 rounded-full mb-8">
                    <div
                        className={`absolute top-0 left-0 h-full rounded-full transition-all duration-300 ${getSliderColor()}`}
                        style={{ width: `${(foodNoise / 10) * 100}%` }}
                    />
                    <input
                        type="range"
                        min="0"
                        max="10"
                        value={foodNoise}
                        onChange={(e) => setFoodNoise(e.target.value)}
                        className="absolute -top-2 left-0 w-full h-6 opacity-0 cursor-pointer z-10"
                    />
                    <div
                        className={`absolute top-1/2 -translate-y-1/2 w-6 h-6 bg-white border-2 rounded-full shadow-md transition-all pointer-events-none`}
                        style={{
                            left: `calc(${(foodNoise / 10) * 100}% - 12px)`,
                            borderColor: foodNoise <= 3 ? '#14b8a6' : foodNoise <= 7 ? '#f97316' : '#ef4444'
                        }}
                    />
                </div>

                <div className="flex justify-between text-[10px] text-slate-400 font-bold uppercase tracking-widest px-1">
                    <span>Silencioso</span>
                    <span>Intenso</span>
                </div>
            </div>

            {/* Daily Note */}
            <div className="glass-panel p-6 rounded-[32px] shadow-soft stagger-4 fade-in">
                <label className="block text-sm font-bold text-slate-600 mb-3 uppercase tracking-wide font-outfit">Di√°rio R√°pido</label>
                <textarea
                    value={note}
                    onChange={(e) => setNote(e.target.value)}
                    className="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm text-slate-700 placeholder-slate-400 focus:ring-2 focus:ring-brand-500 transition-shadow resize-none"
                    rows="3"
                    placeholder="Como voc√™ se sentiu hoje? Ex: Senti um pouco de tontura ao levantar..."
                ></textarea>
            </div>

            <Button className="stagger-5 fade-in w-full py-5 rounded-[24px] text-lg shadow-xl !bg-slate-900 !from-slate-900 !to-slate-800">
                Salvar Registro
            </Button>

            {/* Modal de Informa√ß√£o: Food Noise */}
            <Modal
                isOpen={showFoodNoiseInfo}
                onClose={() => setShowFoodNoiseInfo(false)}
                title="O que √© Food Noise?"
            >
                <div className="space-y-4 text-slate-600">
                    <p className="text-sm leading-relaxed">
                        O "ru√≠do alimentar" s√£o aqueles pensamentos constantes e intrusivos sobre comida que podem dificultar o controle do peso.
                    </p>
                    <div className="space-y-3">
                        <div className="flex gap-3 items-start bg-teal-50 p-3 rounded-xl border border-teal-100">
                            <div className="font-bold text-teal-600 text-sm">0-3</div>
                            <p className="text-xs">**Silencioso:** Voc√™ s√≥ pensa em comida quando est√° com fome f√≠sica real.</p>
                        </div>
                        <div className="flex gap-3 items-start bg-orange-50 p-3 rounded-xl border border-orange-100">
                            <div className="font-bold text-orange-500 text-sm">4-7</div>
                            <p className="text-xs">**Moderado:** Pensamentos ocasionais sobre comida ou desejo por snacks espec√≠ficos.</p>
                        </div>
                        <div className="flex gap-3 items-start bg-red-50 p-3 rounded-xl border border-red-100">
                            <div className="font-bold text-red-500 text-sm">8-10</div>
                            <p className="text-xs">**Alto:** Pensamentos constantes sobre a pr√≥xima refei√ß√£o ou snacks.</p>
                        </div>
                    </div>
                </div>
            </Modal>
        </div>
    );
};

export default Logs;
